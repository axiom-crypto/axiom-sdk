import { ethers } from "ethers";
import {
  Axiom,
  AxiomConfig,
  AxiomV2Callback,
  QueryV2,
  bytes32,
  AxiomV2ComputeQuery,
  buildReceiptSubquery,
  getTxHash,
  buildTxSubquery,
  TxField,
} from "../../../src";
import { convertToBytes32 } from "../../../dist/halo2-js";

describe("On-chain compute query scenarios", () => {
  const provider = new ethers.JsonRpcProvider(process.env.PROVIDER_URI_GOERLI as string);
  const config: AxiomConfig = {
    privateKey: process.env.PRIVATE_KEY_GOERLI as string,
    providerUri: process.env.PROVIDER_URI_GOERLI as string,
    version: "v2",
    chainId: 5,
    // mock: true
  };
  const overrides = {
    // Addresses: {
    //   AxiomQuery: "",
    // },
  };
  const axiom = new Axiom(config, overrides);

  const exampleClientAddr = "0x41a7a901ef58d383801272d2408276d96973550d";
  const exampleClientAddrMock = "0x8fb73ce80fdb8f15877b161e4fe08b2a0a9979a9";
  const vk = [
    2,
    13,
    0,
    0,
    0,
    0,
    6,
    0,
    0,
    0,
    22,
    53,
    175,
    191,
    189,
    44,
    47,
    125,
    102,
    223,
    68,
    183,
    53,
    24,
    221,
    245,
    11,
    40,
    210,
    84,
    147,
    34,
    241,
    111,
    251,
    44,
    176,
    97,
    40,
    23,
    111,
    5,
    236,
    172,
    54,
    30,
    205,
    68,
    139,
    37,
    34,
    255,
    110,
    222,
    63,
    213,
    167,
    105,
    46,
    125,
    148,
    2,
    105,
    228,
    6,
    175,
    114,
    9,
    31,
    238,
    182,
    133,
    168,
    45,
    28,
    159,
    208,
    89,
    2,
    25,
    123,
    44,
    175,
    207,
    178,
    3,
    221,
    30,
    25,
    215,
    156,
    251,
    160,
    211,
    110,
    185,
    184,
    40,
    149,
    62,
    212,
    252,
    3,
    33,
    213,
    13,
    168,
    207,
    31,
    79,
    122,
    8,
    89,
    199,
    135,
    196,
    192,
    174,
    16,
    147,
    131,
    241,
    135,
    209,
    141,
    121,
    218,
    157,
    251,
    41,
    43,
    229,
    189,
    79,
    74,
    73,
    203,
    38,
    10,
    225,
    22,
    159,
    68,
    40,
    178,
    33,
    77,
    56,
    45,
    239,
    47,
    26,
    48,
    164,
    220,
    229,
    77,
    11,
    146,
    91,
    234,
    0,
    222,
    21,
    9,
    189,
    92,
    8,
    48,
    21,
    219,
    88,
    148,
    231,
    146,
    23,
    206,
    174,
    143,
    102,
    244,
    158,
    218,
    170,
    16,
    40,
    217,
    41,
    193,
    180,
    163,
    195,
    189,
    243,
    165,
    124,
    168,
    64,
    88,
    48,
    31,
    43,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    19,
    94,
    101,
    9,
    254,
    49,
    236,
    93,
    96,
    23,
    118,
    181,
    46,
    30,
    41,
    236,
    48,
    44,
    15,
    112,
    137,
    187,
    108,
    11,
    230,
    43,
    96,
    111,
    69,
    50,
    153,
    25,
    204,
    129,
    129,
    113,
    41,
    52,
    239,
    50,
    191,
    209,
    143,
    20,
    213,
    216,
    45,
    5,
    231,
    59,
    177,
    9,
    196,
    52,
    186,
    84,
    74,
    53,
    53,
    208,
    113,
    74,
    25,
    47,
    136,
    9,
    246,
    57,
    166,
    7,
    252,
    165,
    231,
    133,
    67,
    159,
    89,
    40,
    185,
    227,
    220,
    49,
    214,
    153,
    188,
    68,
    30,
    142,
    194,
    8,
    20,
    25,
    249,
    80,
    147,
    31,
    161,
    87,
    175,
    54,
    150,
    94,
    83,
    148,
    106,
    110,
    69,
    205,
    74,
    58,
    128,
    93,
    13,
    63,
    58,
    119,
    119,
    156,
    38,
    59,
    157,
    102,
    121,
    158,
    173,
    155,
    207,
    7,
    129,
    32,
    221,
    160,
    2,
    15,
    131,
    249,
    95,
    54,
    190,
    51,
    37,
    210,
    75,
    10,
    123,
    164,
    170,
    220,
    46,
    2,
    32,
    0,
    126,
    162,
    161,
    23,
    118,
    254,
    8,
    8,
    145,
    202,
    133,
    199,
    119,
    206,
    57,
    43,
    71,
    250,
    177,
    202,
    247,
    247,
    49,
    208,
    24,
    55,
    134,
    206,
    167,
    14,
    195,
    5,
    67,
    75,
    229,
    119,
    93,
    216,
    75,
    48,
    129,
    127,
    109,
    132,
    109,
    219,
    168,
    23,
    159,
    8,
    162,
    147,
    15,
    247,
    240,
    86,
    108,
    80,
    248,
    240,
    65,
    159,
    237,
    247,
    215,
    190,
    191,
    70,
    240,
    218,
    95,
    15,
    139,
    84,
    196,
    177,
    252,
    158,
    196,
    233,
    173,
    21,
    59,
    139,
    120,
    126,
    241,
    79,
    176,
    156,
    21,
    225,
    98,
    163,
    218,
    200,
    210,
    106,
    88,
    71,
    32,
    119,
    134,
    30,
    248,
    17,
    160,
    55,
    121,
    168,
    124,
    85,
    5,
    232,
    156,
    11,
    224,
    89,
    116,
    78,
    181,
    45,
    120,
    198,
    223,
    203,
    156,
    189,
    160,
    140,
    117,
    105,
    10,
    53,
    212,
    37,
    140,
    202,
    224,
    95,
    204,
    114,
    5,
    234,
    227,
    19,
    84,
    3,
    218,
    83,
    80,
    10,
    207,
    66,
    72,
    41,
    104,
    80,
    210,
    173,
    6,
    147,
    3,
    3,
    204,
    9,
    218,
    43,
    35,
    36,
    5,
    172,
    46,
    169,
    251,
    184,
    212,
    165,
    201,
    147,
    253,
    107,
    135,
    14,
    26,
    9,
    80,
    245,
    138,
    84,
    45,
    246,
    75,
    105,
    226,
    144,
    160,
    229,
    102,
    4,
    232,
    113,
    13,
    47,
    85,
    223,
    168,
    20,
    205,
    28,
    186,
    82,
    226,
    253,
    139,
    166,
    67,
    97,
    144,
    21,
    186,
    35,
    159,
    158,
    228,
    38,
    196,
    12,
    95,
    157,
    154,
    2,
    142,
    121,
    143,
    6,
    8,
    179,
    106,
    157,
    155,
    217,
    18,
    101,
    196,
    132,
    72,
    190,
    95,
    68,
    239,
    44,
    137,
    58,
    243,
    46,
    35,
    108,
    214,
    53,
    55,
    219,
    85,
    27,
    6,
    120,
    27,
    234,
    122,
    190,
    156,
    185,
    136,
    22,
    96,
    41,
    175,
    222,
    2,
    99,
    20,
    67,
    69,
    129,
    29,
    135,
    146,
    85,
    144,
    5,
    117,
    158,
    117,
    230,
    133,
    35,
  ];
  const computeProof =
    "0x00000000000000000000000000000000c42079f94a6350d7e6235f29174924f90000000000000000000000000000000028cc2ac818eb64fed8004e115fbcca6700000000000000000000000000000000000000000000000000000000b39244890000000000000000000000000000000032f6ef430555631f765df0dfae34eff30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000092a653000000000000000000000000000000000000000000000000000000003fc91a3a00000000000000000000000000000000fd70395cd496c647d5a6cc9d4b2b7fad00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e5e50a6c7ca781b993dafd4801a558b2bcd9f11a35568a5562345efd72effc63ac642b7ec191774b856e6925558795f1302966a710427c4663e3ebadfb5c585c10195cfbd49ae197658db612f0582da5a9c52bbf9f5e166500f380a92e361850e09bb7c7d7912e2e55111f2bc8c1933222ff5c7c137349e0bd38081ce5c00f115d0ede2d347b7729e78dd64c11dd1c47b12c121271d60749e75826b3bb52c744171e4c1e228809c420a3ca518e2d124b76baf12bf27f73d7e60f0d26b7a2bc5307be6fd96dbc96ea11dc4ad2bc48da0156161e2310aa38ec916fa1e487c812044802eab314ca4319de9900bdf6685df43a6921765b37a91eccd02a528780aa43dea0e4e2bcb193a4c1845385427bc99619fcdeae11a6c2d64ae7896df00c6b2d7401ab3dec9488254fe7aa7fd16a3178f5f88d3afa744fb9800a8331587e160f312cb90eb27415020b37c9231566b2cb81669a60444dd10691ddd5662a13b44af56f5c5d79c735cc6b73dfc809470ff681260ec484e4648e51f01d75ca075e4cb17a6fa3fa4301f17abd956c5d781c2d8ca148f8924873da79d4b8297fe01827998b7bac4e1e5dc865406ed64682ccd6ce8e51337348ea58d626e9642c3bc523707c713d97ec83a4ffab8b83d950c489142bc063d0b675514a286625277c9705543da909d88cba8c190cc49e086a70c3528ebe4ad6a20383302e027070cea45448bc453ffe8cc5e36b77b5e46878a6f390883fc7ea074ebd49cdc867e23a970cb97653e8c1326f1e7291396c636ff49d833851b1e3a929e9a9e2daf120b1dc20da7a0e4c5d17c7f70db18e352ec7e01a40a84363e0200cc38e38a5523fda782ae5681172026ab59afc1b2429fcb3b35131e06b5f6842c14dbaaa34461298ec1cfac0789d99c86130cfb4be754675956dca6b5f9a8fdd9fd557bdd625bb1ee127dc13dd4b3ce62c38ce2bc9844dd1a0c30a5a24a16e874b59efd7ada8f07dc42db7a24d256a6caaa5bbf4d17cf1f698beac610a84a5936cf3d7941e3244a09512c53d01456c05cdd6fb7a24b77ff48e4a1c444ae9b230ff9e619d8c7c5bf937140c360198764ceb3e257a781310a46bb79e8e6483a1aa6d0b475392ac5d0cbc0f59377f0250a408e42e18920f9e044637d1daf74de529d00a992bff30a45d5513169d3f39a1dd0f83419d543f9f2e6441dce66bd565b00a3ba32c2f5e2f56622971c58afac88d56783e0d95ec17bc8ccf98f7d45a351a1caea4bff3a7fe0c2a02f6c7e9c7e5f4a6892007ca1c6b9515679fdb21df4f616ab299c43d53247ee7182e35d79b78cec926db9e71c079aafd51922d330371bf1c1d2f42e0c3c5bb7d035894ff1636e1974e50b77046847759ce4c838e2d14fbf25f39f7959556ef891aed5a5192fa797fd58cc68c8ee0abbc3ff9adb07670244dc1758e8574e28a2f09ab36d1d4879c915d0f23953959b86a87efe58092bc8fbb30299baccfd87cc80f0cf3fca9d1962d1acd53ffc9f27b629cafff163752359c82cba38af7c8e55a1044fd4681d1efa822116441860cc07d6bd1df087c0c9628bbba38bc1f8826110f46ce38899fc3660b5c859fb5a75f422cc5bb051aab8b0218c443fba387202a19000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fc7665dee8284c00311ebdd9a768c95d1f0d89549130a2a65114a604f713b627248e28681f7e18a50baea8eb7714f855d5de473bbcdd21e1d27a0e4c42098d24ecd5448e3a20cb3998cd46d3746d2ae0dde5813da6f94930c5f2f29b70685b1b37f8a0cb8d0c6fc6c104fa8b312792fa06effde11eaa53a60013dc84be82b40c95524542e72ca499ae4a08f407301cb61fd5fd41eef493de4df0ec13a0718902dca7519519118ea6099a6caaa3a21895b38de3b0a451e6597e91e79cdfa49e0c1d5047af181477f46bc619ad5d766128ed835f5e1ccb34f16fad69db7bdb411330086fd8b3bebbf22bb0757c1f13fc832185311d53a340d010c81f30e0536b262b943c57ced5f01b8027dd75f940c558a8b8fef0269d6c28390cb83acb3bb003025bef7ca8dde625c6f6917fa51934de1da3ded1c6803e83f7cb350a8299aa20062207b25cc480dd19c5aa0f7224ba71c91b4e448353c0f907c355b3106e4e0a8cbb937c68f8ae539897478aff768897bb37da732d615fb4902ebcc4afee0f064ca4d7815921186de5943ac763cb523edf3593c2a54b5d3a3f7f62ae25d24f239b365c6cbb197e6df58ac3bf7bb5a0094e5413589d74a65dae211154fd5b1921f16657c6fce4a1578d0242290d2f7c7d17eeb630d3a26bf60a9258fd115a6803a7ba65d266011222f553026c300f04cea16c842347742a874508ac4675c3c418face40cb0fe03bad90224a75326edd329f0ca776195b65058a979b4e368e9d2f0eae3c70228e1d2a300347506c2ef373056e63b22d8ca69a504f966abee1011ebcf35ef0fdf94f47502769b21458cd6e0ba4e4d72cc2a27de5936ed74d26e6012f5dd9623b72f9c1b8fe20414774b1c53155bbd3c56ae704508ae1b988250b2318f890651716c5df2ceda0257896b3023d7c04502baf541e4c6ab31c254d4b18751a13e420ea4950dec7eac6af04c6acb0a2b2261b6c9be21c8941f97aa37c2850fc3b0a05dd7f275ff90555f8cd072a2ff8a373c42cc337f3c0258c32ac802bcaef61363d52d0615023492801b08483d4368c8dfcef2f642452e57b8be81b0e89e3e389fbb4384cc5057c5ac82e54313c898ad039232d0798a35740a15bb95f26b1f2668a1e7b40fd894e934f7e8a24b446c3fc3e109d92bb2be9077931b660";

  // const vkey = convertToBytes32(new Uint8Array(vk)).map(x => "0x" + x);
  // console.log(vkey);

  // const vkey = [
  //   "4a0c5d8021f6eeca4adfbd08ee866261ed35db4bee02a1e6f73e9c3b696aac04",
  //   "005943ec6e126d9b0f712411bea491ff0cbfd4473fd4b3c0e91c1d5ec62b5c40",
  //   "c1e55b79b0fe9395c941166b8ca092f57ed9706a0ce486c13bfbbd20a29d901c",
  //   "fbcdc42f5b210bd6e7d4d92fed692dbaf1f96f7a056ec75f568aae9f0db32220",
  //   "0000000000000000000000000000000000000000000000000000000000000080",
  //   "0000000000000000000000000000000000000000000000000000000000000080",
  //   "0000000000000000000000000000000000000000000000000000000000000080",
  //   "5fbf62456ed287e062bced25b64a08bbbd608962b946c1817da2ccb579a0a854",
  //   "e13ac4a7a1a09c191b05b5b8de3768ad9b4261e94363555c2b63ee6262437122",
  //   "22e4c62aacfc240ed0553bfad00122ba8c7627c870c739f3f818584e066a8b1f",
  //   "841485e0a9f109688bdc4f5ff851d9e2e44833ae573456742c1237322e938542",
  //   "79a62f1cc2f1440cc9fdcd534b612a49da4b6139bbed8cf53a26f4568ac3f567",
  //   "26b421df9f9eaf3030fbc35de42f50a0ebc8c48bbe2ea5b79603102a5631a915",
  //   "87298ccd7f30f8341a5ec84cbd0d8b9f6224f69918fc9cad91b9fa3be47f0d04",
  // ].map(x => "0x" + x);

  const vkey: string[] = [];
  const vkHex =
    "0xd743c093c2cf5254b5d217798cb3de50c52996a8fb805e9dac7fd0ef6f8d601ac04b25057d0bddf35d4542077516abb76445b8e745a457e3ccc1bf9aac2ba406b502f3f62c7a69b2a5e101c2cd927b9d25118467ebd1d3e1e3cad80abee34c285e94f8f9d8bcc624b91a7953ded93d8df6facbab85fec15a4fe54eada38be9630000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000804169caa14cde6751befdc67fb8447b7c5eb1ed28b36a4c123c37238a6671a30e943afb4c50caaf722958cf03b78f5acc2a58cd7b50102842c7e8be532add3f6822e4c62aacfc240ed0553bfad00122ba8c7627c870c739f3f818584e066a8b1f841485e0a9f109688bdc4f5ff851d9e2e44833ae573456742c1237322e93854279a62f1cc2f1440cc9fdcd534b612a49da4b6139bbed8cf53a26f4568ac3f567e40c0e4521b32cf17ce45eee625a7e525481b412984310e1fb44eef5a34ab34c6159bc0fe550116eca8acdb816c0a6ef4ad048d3bf9f8fd113979be03e24c742";
  let i = 0;
  const vkHexSlice = vkHex.slice(2);
  while (i < vkHexSlice.length) {
    vkey.push("0x" + vkHexSlice.slice(i, i + 64).padStart(64, "0"));
    i += 64;
  }
  console.log(vkey);

  test("Send a simple Compute Query", async () => {
    const query = (axiom.query as QueryV2).new();

    const blockNumber = 9610835;
    const txIdx = 6;
    const logIdx = 3;
    const eventSchema = "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67";

    const txHash = await getTxHash(provider, blockNumber, txIdx);
    if (txHash === null) {
      throw new Error("txHash is null");
    }

    // Append a Receipt Subquery that gets the following event schema:
    // Swap(address,uint256,uint256,uint256,uint256,address)
    // 0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67
    let receiptSubquery = buildReceiptSubquery(txHash)
      .log(logIdx)
      .topic(0) // topic 0: event schema
      .eventSchema(eventSchema);
    query.appendDataSubquery(receiptSubquery);

    // Append a Receipt Subquery that checks the address recipient field
    receiptSubquery = buildReceiptSubquery(txHash)
      .log(logIdx)
      .topic(2) // topic 2: recipient
      .eventSchema(eventSchema);
    query.appendDataSubquery(receiptSubquery);

    // Append a Receipt Subquery that gets the block number of the transaction receipt
    receiptSubquery = buildReceiptSubquery(txHash).blockNumber(); // block number of the transaction
    query.appendDataSubquery(receiptSubquery);

    // Append a Transaction Subquery that gets the `to` field of the transaction
    let txSubquery = buildTxSubquery(txHash).field(TxField.To);
    query.appendDataSubquery(txSubquery);

    const computeQuery: AxiomV2ComputeQuery = {
      k: 13,
      resultLen: 4,
      vkey,
      computeProof,
    };
    query.setComputeQuery(computeQuery);

    const callback: AxiomV2Callback = {
      target: exampleClientAddr,
      extraData: bytes32(0),
    };
    query.setCallback(callback);

    const isValid = query.validate();
    expect(isValid).toBeTruthy();

    const builtQuery = await query.build();
    console.log(builtQuery);
    const paymentAmt = query.calculateFee();
    const queryId = await query.sendOnchainQuery(paymentAmt, (receipt: ethers.ContractTransactionReceipt) => {
      console.log("receipt", receipt);
    });
    console.log("queryId", queryId);
  }, 40000);
});
